# Default server block
server 
{
    {
        listen 8080;                   # The port the server will listen on
        server_name example.com;
    }         # The domain name

    # Root location serving static files
    location / {
        root /var/www/html;          # The directory to serve static files from
        index index.html;            # Default file to serve when accessing directories
        autoindex off;               # Disable automatic directory listing
    }

    # Uploads location, allows file uploads with size limit
    location /uploads {
        root /var/www/uploads;       # Directory for file uploads
        allow_uploads true;          # Enable file uploads
        max_body_size 20M;           # Limit file upload size to 20MB
    }

    # Reverse Proxy for API Requests
    location /api {
        proxy_pass http://127.0.0.1:5000;  # Forward API requests to backend server on port 5000
        proxy_set_header X-Real-IP $remote_addr;  # Preserve client IP in the header
        proxy_set_header Host $host;   # Preserve the original Host header
    }

    # CGI execution for Python scripts
    location /cgi-bin/ {
        cgi_pass /usr/bin/python3;   # Use Python 3 for executing CGI scripts
    }

    # Custom error pages
    error_page 404 /errors/404.html;   # Custom error page for 404 Not Found
    error_page 500 /errors/500.html;   # Custom error page for 500 Internal Server Error

    # Logging configuration (optional but useful for debugging)
    access_log /var/log/webserv/access.log;
    error_log /var/log/webserv/error.log;
}

# A second server block for a different website (virtual host)
server {
    listen 9090;                    # A second server block running on a different port
    server_name anotherexample.com;  # A different domain name

    location / {
        root /var/www/anotherexample; # Serving static files for this website
        index home.html;
    }
}
