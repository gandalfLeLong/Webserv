# Example configuration for Webserv project

# Server listening on port 8080
server {
    listen 8080;
    server_name localhost;

    # Default server configuration
    # This server will respond to all unmatched requests on port 8080
    root /tmp/www;  # Root directory for the server

    # Default error page setup
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    # Location for custom error pages
    location = /404.html {
        root /tmp/www;
        internal;
    }

    location = /50x.html {
        root /tmp/www;
        internal;
    }

    # Limit client body size (e.g., max upload size)
    client_max_body_size 10M;

    # Default file for directory requests
    location / 
    {
        {
            {
                index index.html index.htm;
            }
        }
    }

    # Example of a route with HTTP methods allowed
    location /kapouet {
        allow_methods GET POST;
    }

    # Handle .php files via CGI (PHP-FPM)
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME /tmp/www$fastcgi_script_name;
        include fastcgi_params;
    }

    # Upload files (with a maximum file size of 10MB)
    location /upload {
        client_max_body_size 10M;
        upload_pass /tmp/uploads;  # Save uploaded files to this directory
    }

    # Enable directory listing for a specific location
    location /files {
        autoindex on;
    }

    # Redirect from old path to a new one (301 Permanent Redirect)
    location /old-path {
        return 301 /new-path;
    }

    # Handle requests to a specific location and route them to a folder
    location /images {
        root /tmp/www/images;  # Serve images from the /tmp/www/images directory
    }

    # Example of a custom route with regular expressions (e.g., matching image file extensions)
    location ~* \.(jpg|jpeg|png|gif)$ {
        root /tmp/www/images;
    }

    # Enable CGI for a specific route (e.g., .py files)
    location ~ \.py$ {
        fastcgi_pass unix:/var/run/python/python3-fpm.sock;
        fastcgi_param SCRIPT_FILENAME /tmp/www$fastcgi_script_name;
        include fastcgi_params;
    }
}

# A second server with a different configuration (e.g., for a different domain)
server {
    listen 8081;
    server_name example.com;

    root /tmp/www;

    # Handle .html files (simply serve them from the file system)
    location ~ \.html$ {
        root /tmp/www;
    }

    # Handle POST and GET methods for a specific route
    location /submit {
        allow_methods POST GET;
        # Handle POST data (e.g., form submission)
    }

    # Redirect to HTTPS (example of HTTP to HTTPS redirect)
    location /old-secure-page {
        return 301 https://example.com/new-secure-page;
    }
}

# Default server for any unmatched requests (if no other server matches)
server {
    listen 8080 default_server;
    server_name _;  # Catch-all for unmatched requests

    root /tmp/www;

    location / {
        index index.html;
    }

    # Default error pages for this server
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
}

# Additional server configurations can go here...
